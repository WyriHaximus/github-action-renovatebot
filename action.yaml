name: Renovate
description: 'Wrapper action around Renovate'
branding:
  icon: 'refresh-cw'
  color: 'blue'
inputs:
  renovateAppToken:
    description: Renovate app token for authentication
    required: true
  logLevel:
    description: Log level for Renovate execution
    default: info
    required: false
  hostRules:
    description: Host rule configuration JSON object as a string
    default: ""
    required: false
runs:
  using: "composite"
  steps:
    - name: Self-hosted Renovate
      uses: renovatebot/github-action@v43.0.11
      with:
        token: ${{ inputs.renovateAppToken }}
      env:
        RENOVATE_ALLOW_PLUGINS: true
        RENOVATE_ALLOW_SCRIPTS: true
        RENOVATE_ALLOWED_COMMANDS: "[\"git add\"]"
        RENOVATE_AUTODISCOVER: true
        RENOVATE_BINARY_SOURCE: docker
        RENOVATE_POST_UPGRADE_TASKS: "{\"commands\": [\"git add\"], \"fileFilters\": [\"**/**\"], \"executionMode\": \"update\"}"
        RENOVATE_DOCKER_CLI_OPTIONS: "-t -e=COMPOSER_IGNORE_PLATFORM_REQS=1"
        RENOVATE_HOST_RULES: ${{ inputs.hostRules }}
        RENOVATE_DRY_RUN: "null"
        RENOVATE_IGNORE_PLUGINS: false
        RENOVATE_IGNORE_SCRIPTS: false
        RENOVATE_ONBOARDING_CONFIG: "{\"$schema\":\"https://docs.renovatebot.com/renovate-schema.json\",\"extends\":[\"github>WyriHaximus/renovate-config:php-package\"]}"
        RENOVATE_ONBOARDING_CONFIG_FILE_NAME: ".github/renovate.json"
        RENOVATE_ONBOARDING_REBASE_CHECKBOX: "true"
        LOG_LEVEL: ${{ inputs.logLevel }}
        LOG_FORMAT: ${{ inputs.logLevel == 'debug' && 'json' || '' }}
